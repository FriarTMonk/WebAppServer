generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Session {
  id                    String    @id @default(uuid())
  userId                String?   // null for anonymous users
  title                 String
  status                String    @default("active") // 'active' | 'completed'
  preferredTranslation  String    @default("NIV") // Bible translation preference
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  messages              Message[]

  @@index([createdAt])
  @@index([userId])
}

model Message {
  id                       String   @id @default(uuid())
  sessionId                String
  role                     String   // 'user' | 'assistant' | 'system'
  content                  String   @db.Text
  scriptureReferences      Json     @default("[]")
  constitutionalReferences Json     @default("[]")
  timestamp                DateTime @default(now())

  session                  Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([timestamp])
}

// Bible Translation metadata
model BibleTranslation {
  code        String        @id @unique // 'NIV', 'NASB', 'NKJV', 'ESV'
  name        String        // Short name
  fullName    String        // Full name
  description String?       @db.Text
  isActive    Boolean       @default(true)
  createdAt   DateTime      @default(now())

  verses      BibleVerse[]

  @@index([isActive])
}

// Individual Bible verses across all translations
model BibleVerse {
  id               String            @id @default(uuid())
  translationCode  String            // Foreign key to BibleTranslation
  book             String            // e.g., 'John', 'Genesis'
  chapter          Int
  verse            Int
  text             String            @db.Text

  translation      BibleTranslation  @relation(fields: [translationCode], references: [code], onDelete: Cascade)

  // Ensure no duplicate verses per translation
  @@unique([translationCode, book, chapter, verse])

  // Optimize verse lookups
  @@index([translationCode, book, chapter, verse])
  @@index([book])
}
